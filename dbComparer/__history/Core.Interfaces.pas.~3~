unit Core.Interfaces;

interface

uses System.Classes, Core.Types;

type
  // Contrato para leer la estructura de la BD
  IDBMetadataProvider = interface
    ['{026B999C-B5BD-4C33-A080-9675C56A0738}'] // Presiona Ctrl+Shift+G en Delphi
    function GetTables: TStringList;
    function GetTableStructure(const TableName: string): TTableInfo;
    function GetTableIndexes(const TableName: string): TArray<TIndexInfo>;
    function GetTriggers: TArray<TTriggerInfo>;
    function GetTriggerDefinition(const TriggerName: string): string;
    function GetViews:TStringList;
    function GetViewDefinition(const ViewName:string):string;
    function GetProcedures:TStringList;
    function GetProcedureDefinition(const ProcedureName:string):string;
  end;

  // Contrato para escribir el script
  IScriptWriter = interface
    ['{638AC4C1-4AF7-48CF-ACD9-602E3BAC1228}']
    procedure AddComment(const Text: string);
    procedure AddCommand(const SQL: string);
    function GetScript: string;
  end;

  IDBHelpers = interface
    ['{1DCC0AC2-C36B-461F-9DFA-D63CD007C660}']
    // Comparaci�n (l�gica mayormente universal)
    function ColumnsAreEqual(const Col1, Col2: TColumnInfo): Boolean;
    function IndexesAreEqual(const Idx1, Idx2: TIndexInfo): Boolean;
    // Generaci�n SQL (espec�fico de cada motor)
    function TriggersAreEqual(const Trg1, Trg2: TTriggerInfo): Boolean;
    function QuoteIdentifier(const Identifier: string): string;
    function GenerateColumnDefinition(const Col: TColumnInfo): string;
    function GenerateIndexDefinition(const TableName: string;
                                     const Idx: TIndexInfo): string;
    function GenerateCreateTableSQL(const Table: TTableInfo;
                                    const Indexes: TArray<TIndexInfo>): string;
    function GenerateAddColumnSQL(const TableName:string; const ColumnInfo:TColumnInfo): string;
    function GenerateDropColumnSQL(const TableName, ColumnName:string): string;
    function GenerateModifyColumnSQL(const TableName:string; const ColumnInfo:TColumnInfo): string;
    function GenerateDropIndexSQL(const TableName, IndexName:string): string;
    // Normalizaci�n (espec�fico de cada motor)
    function NormalizeType(const AType: string): string;
    function NormalizeExtra(const AExtra: string): string;
  end;
implementation
end.